on: issue_comment

name: Example

jobs:
  parse-comment:
    runs-on: ubuntu-latest
    if: ${{ github.event.issue.pull_request }}
    outputs:
      command: ${{ steps.parse-comment.outputs.command }}
    steps:
      - uses: drewwyatt/comment-pipeline@v1
        id: parse-comment
        with:
          comment: ${{ toJSON(github.event.comment) }}
          commands: |
            /repackage
          github-token: ${{ secrets.GITHUB_TOKEN }}

  repackage:
    runs-on: ubuntu-latest
    needs: [parse-comment]
    if: ${{ needs.parse-comment.outputs.command == '/repackage' }}
    steps:
      - uses: actions/checkout@v2
        with:
          token: ${{ secrets.PAT }}
      - name: Install
        run: npm ci
      - name: Build and package
        run: |
          npm run build
          npm run package
      - uses: stefanzweifel/git-auto-commit-action@v4
        name: Commit Changes
        id: auto-commit-action
        with:
          commit_message: repackage
